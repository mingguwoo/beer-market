<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nio.ngfs.plm.bom.configuration.infrastructure.repository.mapper.BomsOxoRowInfoMapper">


    <insert id="insertOxoRows"
            parameterType="com.nio.ngfs.plm.bom.configuration.infrastructure.repository.entity.BomsOxoRowInfoEntity">
        INSERT INTO boms_oxo_row_info (
        model_code,
        feature_code,
        rule_check,
        comments,
        is_head,
        sort,
        sort_delete,
        create_user,
        update_user
        )
        VALUES
        <foreach collection="bomsOxoRowInfoEntitys" item="entity" index="index" separator=",">
            (#{entity.modelCode},#{entity.featureCode},#{entity.ruleCheck},#{entity.comments}
            ,#{entity.isHead},#{entity.sort}
            ,#{entity.sortDelete},#{entity.createUser},#{entity.updateUser})
        </foreach>
        ON DUPLICATE KEY UPDATE
        <trim prefix="" suffixOverrides=",">
            <foreach collection="bomsOxoRowInfoEntitys" item="entity" separator=",">
                del_flag=0,
                <if test=" entity.comments!=null">
                    comments=VALUES(comments),
                </if>
                <if test=" entity.ruleCheck!=null">
                    rule_check=VALUES(rule_check),
                </if>
                <if test=" entity.sort!=null and entity.sort >0">
                    sort=VALUES(sort),
                </if>
                update_user=VALUES(update_user)
            </foreach>
        </trim>
    </insert>



    <select id="queryFeatureListsByModel"
            resultType="com.nio.ngfs.plm.bom.configuration.domain.model.oxo.domainobject.OxoInfoDo">
        select
        a.id,
        a.model_code modelCode,
        a.feature_code featureCode,
        a.rule_check ruleCheck,
        a.is_head  isHead,
        a.comments,
        a.sort,
        a.sort_delete soreDelete,
        b.type,
        b.parent_feature_code parentFeatureCode,
        b.display_name displayName,
        b.chinese_name chineseName,
        b.catalog
        from boms_oxo_row_info
        a inner join boms_feature_library b on a.feature_code=b.feature_code
        where a.model_code=#{modelCode} and a.del_flag=0 and b.status
         ='Active' and b.del_flag=0
    </select>
</mapper>
